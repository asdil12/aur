# Maintainer: Dominik Heidler <dheidler@gmail.com>

pkgname=libuhd
pkgver=3.5.3
_verstring=003_005_003
pkgrel=1
pkgdesc="Universal Software Radio Peripheral userspace driver"
arch=('x86_64' 'i686')
url="http://code.ettus.com/redmine/ettus/projects/uhd/wiki"
license=('GPL')
groups=()
provides=()
depends=('python2-cheetah' 'boost-libs')
makedepends=('cmake' 'boost' 'python2-cheetah')
install='libuhd.install'

source=("libuhd-$pkgver.tar.gz::https://codeload.github.com/EttusResearch/UHD-Mirror/tar.gz/release_$_verstring")
md5sums=('a97f31123a4a1bdd55ee2e0b7822ad10')

build() {
  cd $srcdir/UHD-Mirror-release_$_verstring/host
  # fix for py2k
  find -name "*.py" | xargs sed -i "s|#!/usr/bin/env python$|#!/usr/bin/env python2|"
  mkdir -p build
  cd build
  cmake .. -DCMAKE_INSTALL_PREFIX=/usr/ -DPYTHON_EXECUTABLE=/usr/bin/python2
  make $MAKEFLAGS
}

check() {
  cd $srcdir/UHD-Mirror-release_$_verstring/host/build
  make test
}

package() {
  cd $srcdir/UHD-Mirror-release_$_verstring/host/build
  make DESTDIR=$pkgdir install
} 
